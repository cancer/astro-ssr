"use strict";(()=>{var m=Object.create;var d=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty;var E=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var O=(e,r,o,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of S(r))!v.call(e,a)&&a!==o&&d(e,a,{get:()=>r[a],enumerable:!(t=y(r,a))||t.enumerable});return e};var b=(e,r,o)=>(o=e!=null?m(g(e)):{},O(r||!e||!e.__esModule?d(o,"default",{value:e,enumerable:!0}):o,e));var w=E(l=>{"use strict";l.parse=N;l.serialize=R;var C=Object.prototype.toString,c=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function N(e,r){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var o={},t=r||{},a=t.decode||T,n=0;n<e.length;){var i=e.indexOf("=",n);if(i===-1)break;var s=e.indexOf(";",n);if(s===-1)s=e.length;else if(s<i){n=e.lastIndexOf(";",i-1)+1;continue}var u=e.slice(n,i).trim();if(o[u]===void 0){var p=e.slice(i+1,s).trim();p.charCodeAt(0)===34&&(p=p.slice(1,-1)),o[u]=x(p,a)}n=s+1}return o}function R(e,r,o){var t=o||{},a=t.encode||k;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!c.test(e))throw new TypeError("argument name is invalid");var n=a(r);if(n&&!c.test(n))throw new TypeError("argument val is invalid");var i=e+"="+n;if(t.maxAge!=null){var s=t.maxAge-0;if(isNaN(s)||!isFinite(s))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(s)}if(t.domain){if(!c.test(t.domain))throw new TypeError("option domain is invalid");i+="; Domain="+t.domain}if(t.path){if(!c.test(t.path))throw new TypeError("option path is invalid");i+="; Path="+t.path}if(t.expires){var u=t.expires;if(!A(u)||isNaN(u.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+u.toUTCString()}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.priority){var p=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(p){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var h=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(h){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function T(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function k(e){return encodeURIComponent(e)}function A(e){return C.call(e)==="[object Date]"||e instanceof Date}function x(e,r){try{return r(e)}catch{return e}}});var f=b(w(),1);addEventListener("fetch",e=>{let r=async o=>{let t=new URL(o.request.url),a=(0,f.parse)(o.request.headers.get("cookie")??"")["astro-ssr"],n=new Headers;if(n.append("Access-Control-Allow-Origin","http://localhost:3001"),n.append("Access-Control-Allow-Credentials","true"),t.pathname==="/login/"){if(a!==void 0)return new Response("",{status:204,headers:n});let i=t.searchParams.get("name");if(i===null||i==="")return new Response("Name is invalid.",{status:400,headers:n});let s=String(Date.now());return await SESSION.put(s,JSON.stringify({name:i})),n.append("Set-Cookie",(0,f.serialize)("astro-ssr",s,{maxAge:3600,httpOnly:!0,secure:!0,sameSite:"None",path:"/"})),new Response("",{status:200,headers:n})}if(t.pathname==="/auth/"){if(console.log(a),a===void 0)return new Response("Authorization required.",{status:401,headers:n});let i=await SESSION.get(a,{type:"json"});return i===null?new Response("",{status:404,headers:n}):new Response(JSON.stringify({user:i}),{status:200,headers:n})}return new Response("Hello world",{status:200,headers:n})};e.respondWith(r(e))});})();
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
